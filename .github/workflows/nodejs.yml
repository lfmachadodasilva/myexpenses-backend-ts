name: Node CI

on:
    push:
        branches:
            - master
            - 'dev-*'

jobs:
    build-node:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v1
            - name: Use Node.js 14.x
              uses: actions/setup-node@v1
              with:
                  node-version: 14.x
            - name: Get npm cache directory
              id: npm-cache
              run: |
                  echo "::set-output name=dir::$(npm config get cache)"
            - uses: actions/cache@v1
              with:
                  path: ${{ steps.npm-cache.outputs.dir }}
                  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                  restore-keys: |
                      ${{ runner.os }}-node-
            - name: npm install, build, and test
              run: |
                  npm ci
                  npm run build --if-present
              env:
                  CI: true
            - name: Deploy ðŸš€
              uses: JamesIves/github-pages-deploy-action@releases/v3
              env:
                  GOOGLE_APPLICATION_CREDENTIALS: util/firebase.json
              with:
                  ACCESS_TOKEN: '${{ secrets.GH_PAGES }}'
                  BRANCH: gh-pages
                  FOLDER: dist
